@import "tailwindcss";
@import "tw-animate-css";

/* Keep custom variant from your original setup */
@custom-variant dark (&:is(.dark *));

/* theme mapping */
@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-sans);
  --font-mono: var(--font-mono);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

/* ------------------------
   Brand variables (Greanly)
   ------------------------ */
:root {
  /* radii & spacing */
  --radius: 0.875rem; /* 14px - slightly larger for premium softness */
  --space-xs: 6px;
  --space-sm: 10px;
  --space-md: 18px;
  --space-lg: 28px;
  --space-xl: 40px;

  /* brand colors */
  --green-forest: #0D3B2A;   /* primary */
  --green-leaf:   #D9EDC5;   /* assistant bubble */
  --green-moss:   #14503B;   /* hover / accents */
  --green-mint:   #ECF7E8;   /* soft surface */
  --cream:         #F7F4E9;  /* highlight */
  --earth-brown:  #7A6F5C;   /* optional accent */

  /* neutral system */
  --charcoal:     #10201A;
  --stone-grey:   #6A6A6A;
  --light-grey:   #E9E9E6;
  --white:        #FFFFFF;

  /* utility tokens */
  --background-gradient-start: rgba(237,250,240,0.75); /* very light mint */
  --background-gradient-end: rgba(245,252,248,0.95);   /* almost white */
  --background:   var(--background-gradient-start);
  --foreground:   var(--charcoal);
  --card:         var(--white);
  --card-foreground: var(--charcoal);
  --popover:      var(--white);
  --popover-foreground: var(--charcoal);

  --primary:      var(--green-forest);
  --primary-foreground: var(--white);
  --secondary:    var(--green-moss);
  --secondary-foreground: var(--white);

  --muted:        var(--light-grey);
  --muted-foreground: var(--stone-grey);

  --accent:       var(--cream);
  --accent-foreground: var(--charcoal);

  --destructive:  #D9534F;

  /* subtle borders and surfaces */
  --border:       rgba(13,59,42,0.06); /* subtle green tone */
  --input:        rgba(13,59,42,0.04);
  --ring:         rgba(72,168,118,0.16);

  /* chart fallbacks */
  --chart-1: #14503B;
  --chart-2: #0D3B2A;
  --chart-3: #48A876;
  --chart-4: #4BC2B2;
  --chart-5: #D9EDC5;

  /* sidebar tokens (kept for layout compatibility) */
  --sidebar: var(--white);
  --sidebar-foreground: var(--charcoal);
  --sidebar-primary: var(--green-forest);
  --sidebar-primary-foreground: var(--white);
  --sidebar-accent: var(--green-mint);
  --sidebar-accent-foreground: var(--charcoal);
  --sidebar-border: rgba(13,59,42,0.06);
  --sidebar-ring: rgba(13,59,42,0.08);

  /* paper texture settings (file is at public/recycled-paper.png) */
  --paper-texture: "/recycled-paper.png";
  --paper-texture-2x: "/recycled-paper@2x.png";
  --paper-opacity: 0.95;     /* stronger texture (increase for more visible) */
  --paper-blend: multiply;   /* multiply = authentic recycled paper feel */
  --paper-tile-size: 1200px 1200px; /* scale of the grain pattern */
}

/* Dark theme overrides */
.dark {
  --background-gradient-start: rgba(6,23,18,0.8);
  --background-gradient-end: rgba(10,28,23,0.95);
  --background: #071815; /* deep green-black */
  --foreground: #E7F5EE;
  --card:         #0B2B22;
  --card-foreground: #E7F5EE;
  --popover:      #0B2B22;
  --popover-foreground: #E7F5EE;

  --primary:      #0B2B22; /* darker forest */
  --primary-foreground: #E7F5EE;
  --secondary:    #14503B;
  --secondary-foreground: #E7F5EE;

  --muted:        #0E2A22;
  --muted-foreground: #A6C9B5;

  --accent:       #0E2A22;
  --accent-foreground: #E7F5EE;

  --border:       rgba(255,255,255,0.04);
  --input:        rgba(255,255,255,0.02);
  --ring:         rgba(72,168,118,0.12);

  --chart-1: #48A876;
  --chart-2: #0D3B2A;
  --chart-3: #4BC2B2;
  --chart-4: #D9EDC5;
  --chart-5: #7A6F5C;

  --sidebar: #071815;
  --sidebar-foreground: #E7F5EE;
  --sidebar-primary: #48A876;
  --sidebar-primary-foreground: #E7F5EE;
  --sidebar-accent: #0D3B2A;
  --sidebar-accent-foreground: #E7F5EE;
  --sidebar-border: rgba(255,255,255,0.04);
  --sidebar-ring: rgba(72,168,118,0.12);
}

/* ------------------------
   Base layer (Tailwind + component mappings)
   ------------------------ */
@layer base {
  * {
    box-sizing: border-box;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  html, body, #__next {
    height: 100%;
  }

  /* Layered background: gentle vertical gradient + paper texture (PNG from public/) */
  body {
    font-family: var(--font-sans, Inter), system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color: var(--foreground);
    margin: 0;
    padding: 0;

    /* gradient base (keeps your soft green brand) */
    background-image:
      linear-gradient(180deg, var(--background-gradient-start), var(--background-gradient-end));
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed;
    line-height: 1.52;
    position: relative;
    z-index: 0;
  }

  /* Paper texture applied as fixed pseudo-element for consistent tiling and strong visibility */
  body::before {
    content: "";
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;

    background-image: url(var(--paper-texture));
    background-repeat: repeat;
    background-position: top left;
    background-size: var(--paper-tile-size);

    mix-blend-mode: var(--paper-blend);
    opacity: var(--paper-opacity);

    /* slight adjustments to make the texture feel natural and rich */
    filter: contrast(0.98) saturate(0.9) brightness(1.02);
  }

  /* Retina override: uses @2x if you add recycled-paper@2x.png */
  @media only screen and (min-resolution: 2dppx) {
    body::before {
      background-image: image-set(url(var(--paper-texture-2x)) 2x, url(var(--paper-texture)) 1x);
      background-size: calc(var(--paper-tile-size) / 2);
    }
  }

  /* center & constrain app content to feel premium like a product page */
  .app-container {
    max-width: 1100px;
    margin: 34px auto;
    padding: 28px;
    min-height: calc(100vh - 68px);
    display: flex;
    flex-direction: column;
    gap: 20px;
    position: relative;
    z-index: 1; /* keep above the texture */
  }

  /* card surfaces — tactile, paper-like */
  .soft-card {
    background: var(--card);
    color: var(--card-foreground);
    border-radius: calc(var(--radius) + 4px);
    box-shadow: 0 18px 40px rgba(13,59,42,0.06), 0 2px 6px rgba(13,59,42,0.03);
    border: 1px solid var(--border);
    padding: var(--space-md);
  }

  /* logo + header */
  .brand-row {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 6px;
  }

  .chat-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    padding: 18px;
    border-radius: calc(var(--radius) + 4px);
    background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.35));
    box-shadow: 0 10px 30px rgba(13,59,42,0.04);
    border: 1px solid var(--sidebar-border);
  }

  /* brand badge */
  .chat-brand-badge {
    width: 54px;
    height: 54px;
    min-width: 54px;
    border-radius: 12px;
    background: linear-gradient(180deg, var(--primary), var(--secondary));
    color: var(--primary-foreground);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 18px;
    box-shadow: 0 12px 30px rgba(13,59,42,0.08);
    border: 1px solid rgba(255,255,255,0.02);
  }

  .brand-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--foreground);
    letter-spacing: -0.01em;
  }

  .brand-sub {
    font-size: 13px;
    color: var(--stone-grey);
  }

  /* global typography scale */
  h1, h2, h3, h4 {
    margin: 0 0 8px 0;
    color: var(--foreground);
    font-weight: 600;
  }
  p {
    margin: 0 0 14px 0;
    color: var(--foreground);
    font-size: 15px;
  }

  /* suggestion chips — elevated and pill-like */
  .suggestion-bar {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 8px 6px;
    align-items: center;
  }

  .suggestion-chip {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 999px;
    background: linear-gradient(180deg, var(--green-mint), var(--green-leaf));
    color: var(--green-forest);
    border: 1px solid rgba(20,80,59,0.06);
    font-size: 14px;
    box-shadow: 0 8px 20px rgba(13,59,42,0.03);
    cursor: pointer;
    transition: transform 160ms ease, background 200ms ease, color 160ms ease;
  }
  .suggestion-chip:hover {
    transform: translateY(-3px);
    background: linear-gradient(180deg, var(--green-moss), var(--green-forest));
    color: var(--primary-foreground);
  }

  /* message wall layout */
  .messages {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    padding: var(--space-md);
    border-radius: calc(var(--radius) + 4px);
    background: linear-gradient(180deg, rgba(255,255,255,0.4), rgba(255,255,255,0.28));
    border: 1px solid rgba(13,59,42,0.03);
  }

  .message-row {
    display: flex;
    gap: 14px;
    align-items: flex-start;
  }

  .message-assistant {
    max-width: 78%;
    padding: 18px;
    border-radius: 18px;
    background: linear-gradient(180deg, var(--green-leaf), rgba(217,237,197,0.9));
    color: var(--green-forest);
    box-shadow: 0 14px 36px rgba(13,59,42,0.05);
    border: 1px solid rgba(13,59,42,0.06);
    font-size: 15px;
  }

  .message-user {
    max-width: 78%;
    margin-left: auto;
    padding: 16px;
    border-radius: 18px;
    background: var(--card);
    color: var(--card-foreground);
    border: 1px solid rgba(13,59,42,0.04);
    box-shadow: 0 8px 18px rgba(13,59,42,0.03);
    font-size: 15px;
  }

  .message-meta {
    font-size: 12px;
    color: var(--stone-grey);
    margin-top: 8px;
  }

  /* input area / composer — glass-like, anchored */
  .composer {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.75));
    border-radius: calc(var(--radius) + 6px);
    border: 1px solid rgba(13,59,42,0.03);
    box-shadow: 0 8px 30px rgba(13,59,42,0.04);
  }

  .chat-textarea {
    width: 100%;
    min-height: 48px;
    max-height: 220px;
    padding: 14px 16px;
    border-radius: 12px;
    resize: none;
    background: linear-gradient(180deg, var(--green-mint), rgba(236,247,232,0.92));
    border: 1px solid var(--input);
    color: var(--foreground);
    font-size: 15px;
    line-height: 1.5;
    outline: none;
    transition: box-shadow 180ms ease, border-color 180ms ease, transform 120ms ease;
  }
  .chat-textarea:focus {
    box-shadow: 0 8px 28px rgba(72,168,118,0.08);
    border-color: var(--secondary);
    transform: translateY(-2px);
  }

  /* primary button — circular icon button for send */
  .btn-send {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 46px;
    min-height: 46px;
    padding: 8px;
    border-radius: 999px;
    background: linear-gradient(180deg, var(--primary), var(--secondary));
    color: var(--primary-foreground);
    border: none;
    box-shadow: 0 12px 30px rgba(13,59,42,0.08);
    cursor: pointer;
    transition: transform 120ms ease, box-shadow 160ms ease;
  }
  .btn-send:hover {
    transform: translateY(-2px);
    box-shadow: 0 18px 44px rgba(13,59,42,0.12);
  }

  /* subtle typing indicator */
  .typing-indicator {
    display: inline-flex;
    gap: 8px;
    align-items: center;
  }
  .typing-indicator .dot {
    width: 7px;
    height: 7px;
    border-radius: 9999px;
    background: var(--green-moss);
    opacity: 0.95;
    animation: typing-dot 1s infinite linear;
  }
  .typing-indicator .dot:nth-child(2) { animation-delay: 0.12s; }
  .typing-indicator .dot:nth-child(3) { animation-delay: 0.24s; }
  @keyframes typing-dot {
    0% { transform: translateY(0); opacity: 0.6; }
    50% { transform: translateY(-6px); opacity: 1; }
    100% { transform: translateY(0); opacity: 0.6; }
  }

  /* smaller utility & accessibility tweaks */
  .sr-only {
    position: absolute !important;
    width: 1px; height: 1px;
    padding: 0; margin: -1px; overflow: hidden;
    clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;
  }

  /* keep your existing single-char-link but richer */
  .single-char-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    border-radius: 999px;
    background: var(--card);
    color: var(--card-foreground);
    border: 1px solid var(--input);
    font-weight: 600;
    transition: transform 140ms ease, box-shadow 140ms ease;
  }
  .single-char-link:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(13,59,42,0.05); }
}

/* ------------------------
   Helper classes (layer utilities)
   ------------------------ */
@layer utilities {
  .shadow-green-sm {
    box-shadow: 0 6px 14px rgba(13,59,42,0.04);
  }
  .ring-ghost {
    box-shadow: 0 0 0 6px var(--ring);
  }
  .border-subtle {
    border-color: var(--sidebar-border);
  }
  .bg-assistant {
    background: var(--green-leaf);
  }
  .text-brand {
    color: var(--green-forest);
  }
  .bg-brand {
    background: var(--primary);
    color: var(--primary-foreground);
  }
  .bg-surface {
    background: var(--green-mint);
  }

  /* utility to apply the paper noise directly to elements if needed */
  .paper-noise {
    background-image: url("/recycled-paper.png");
    background-repeat: repeat;
    background-size: var(--paper-tile-size);
    opacity: 0.9;
  }
}

/* responsive fine-tuning */
@media (max-width: 1024px) {
  .app-container { margin: 20px; padding: 18px; max-width: 920px; }
  .chat-brand-badge { width: 48px; height: 48px; min-width: 48px; }
}
@media (max-width: 640px) {
  .app-container { margin: 12px; padding: 12px; }
  .chat-header { padding: 12px; }
  .messages { padding: 12px; }
  .chat-textarea { min-height: 42px; font-size: 14px; }
}

/* Dark-mode texture adjustments */
.dark body::before {
  mix-blend-mode: normal;
  background-color: rgba(3,10,8,0.07);
  background-blend-mode: multiply;
  opacity: calc(var(--paper-opacity) * 0.9);
}
