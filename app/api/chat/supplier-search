import { tool } from "ai";
import { Exa } from "exa-js";

export const supplierSearch = tool({
  description: "Searches for sustainable suppliers for materials or products using Exa.",
  parameters: {
    type: "object",
    properties: {
      query: {
        type: "string",
        description: "What the user is trying to find. Example: 'recycled cotton suppliers India'"
      }
    },
    required: ["query"]
  },

  async execute({ query }) {
    try {
      const exa = new Exa(process.env.EXA_API_KEY as string);

      const search = await exa.searchAndContents(query, {
        useAutoprompt: true,
        numResults: 10
      });

      return {
        results: search.results.map(r => ({
          title: r.title,
          url: r.url,
          snippet: r.text || r.highlight || ""
        }))
      };
    } catch (error: any) {
      console.error("Exa supplier search error:", error);
      return {
        results: [],
        error: "Failed to fetch supplier data from Exa."
      };
    }
  }
});
